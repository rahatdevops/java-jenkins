pipeline {
  agent any

    stages {
      stage('Scm Checkout') {
        steps {
          git branch: 'staging', url: 'https://github.com/rahatdevops/java-jenkins.git'
            }
            }
      stage('Build App') {
        steps {
          sh 'mvn clean package'
            }
            }
      stage('Build Docker Images') {
        steps {
          sh 'docker build -t rahat6/tomcat:v2 . '
            }
            }
      stage('Push the Docker Images') {
         steps {
	withCredentials([string(credentialsId: 'rahathub', variable: 'rahathub')]) {
	      sh "docker login -u rahat6 -p ${rahatHub}"
		}
              sh 'docker push rahat6/tomcat:v2'
            }
            }
      stage('Image Pull and deploy the application') {
         steps {
           sh 'docker rm web -f'
	   sh 'docker pull rahat6/tomcat:v2'
	   sh 'docker run --name web -dit -p 8081:8080 rahat6/tomcat:v2'
				
            }
        }
    }
}
