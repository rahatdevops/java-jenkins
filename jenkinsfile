pipeline {
  agent any

    stages {
      stage('Scm Checkout') {
        steps {
          git branch: 'staging', url: 'https://github.com/rahatdevops/java-jenkins.git'
            }
            }
      stage('Build App') {
        steps {
          sh 'mvn clean package'
            }
            }
      stage('Build Docker Images') {
        steps {
          sh 'docker build -t rahat6/tomcat:v1 . '
            }
            }
      stage('Push the Docker Images') {
         steps {
	   withCredentials([string(credentialsId: 'dockerhub', variable: 'dockerhub')]) {
	      sh "docker login -u rahat6 -p ${dockerHub}"
		}
              sh 'docker push rahat6/tomcat:v1'
            }
            }
      stage('Image Pull and deploy the application') {
         steps {
	   sh 'docker pull rahat6/tomcat:v1'
	   sh 'docker run --name web -dit -p 8081:8080 rahat6/tomcat:v1'
				
            }
        }
    }
}
